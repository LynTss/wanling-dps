<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/wanling_logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/wanling_logo.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>万灵山庄DPS计算器</title>
    </script>
      function loadWebAssembly(path, imports = {}) {
          return fetch(path) // 加载文件
            .then(response => response.arrayBuffer()) // 转成 ArrayBuffer
            .then(buffer => WebAssembly.compile(buffer))
            .then(module => {
              imports.env = imports.env || {}

              // 开辟内存空间
              imports.env.memoryBase = imports.env.memoryBase || 0
              if (!imports.env.memory) {
                imports.env.memory = new WebAssembly.Memory({ initial: 256 })
              }

              // 创建变量映射表
              imports.env.tableBase = imports.env.tableBase || 0
              if (!imports.env.table) {
                // 在 MVP 版本中 element 只能是 "anyfunc"
                imports.env.table = new WebAssembly.Table({ initial: 0, element: 'anyfunc' })
              }

              // 创建 WebAssembly 实例
              return new WebAssembly.Instance(module, imports)
            })
        }
        //调用
        // loadWebAssembly('./wasm_2/index.wasm')
          loadWebAssembly('./wasm/index.wasm')
          .then(instance => {
            console.log('instance', instance)
            // const add = instance.exports._add//取出c里面的方法
            // const square = instance.exports._square//取出c里面的方法

            // console.log('10 + 20 =', add(10, 20))
            // console.log('3*3 =', square(3))
            // console.log('(2 + 5)*2 =', square(add(2 + 5)))
          })

      // async function fetchAndInstantiate() {
      //   console.log('-------')
      //   const importObject = { imports: { imported_func: (arg) => console.log(arg) } };
      //   const response = await fetch("http://localhost:3000/wasm_2/index.wasm");
      //   console.log('response', response)
      //   const text = await WebAssembly.instantiateStreaming(response, importObject)
      //   console.log('text', text)
      //   // const buffer = await response.arrayBuffer();
      //   console.log('buffer', buffer)
      //   // const obj = await WebAssembly.instantiate(buffer);
      //   // console.log(obj.instance.exports.add(1, 2));  // "3"
      // }
      // fetchAndInstantiate()
    </script> -->
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
  </body>
</html>
